generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

/// Пользователь (клиент)
model User {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  name         String?
  tel          String?
  email        String?       @unique

  appointments Appointment[]

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

/// Слот времени (расписание мастера)
model TimeSlot {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  date         DateTime
  time         String

  appointments Appointment[]

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@index([date])
  @@unique([date, time]) // защита от дублей слотов
}

/// Запись клиента
model Appointment {
  id           String            @id @default(auto()) @map("_id") @db.ObjectId

  userId       String            @db.ObjectId
  timeSlotId   String            @db.ObjectId

  status       AppointmentStatus @default(PENDING)
  service      String?

  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  timeSlot     TimeSlot          @relation(fields: [timeSlotId], references: [id], onDelete: Cascade)

  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  @@index([timeSlotId])
  @@index([userId])
}

/// Статус записи
enum AppointmentStatus {
  PENDING      // создана, но не подтверждена
  CONFIRMED    // подтверждена мастером
  CANCELLED    // отменена
  COMPLETED    // услуга оказана
}


model Service {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  slug           String
  title          String
  description    String
  price          String
  serviceImage   String
  time    String
}